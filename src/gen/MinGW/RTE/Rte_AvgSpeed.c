/** @file     Rte_AvgSpeed.c
  *
  * @brief    RTE Sample SWC implementation skeleton file
  *
  * @note     AUTOMATICALLY GENERATED FILE! DO NOT EDIT!
  *
  * @note     Generated by ETAS GmbH  RTA-RTE v5.10.0  (R4.0 backend version: v7.10.4 (Build 52732))
  */

#include "Rte_AvgSpeed.h"
#include "virtualdevices.h"

/* --------------------------------------------------------------------------- */
/* RTE Event: /AComp/AvgSpeed/IB_AvgSpeed/TimingEvent_0 */

FUNC(void, AvgSpeed_CODE) RE_Avg_func(void)
{
   float s1, s2, s3, s4;
   float avg_speed;
   float temp;

	s1 = Rte_DRead_R_4speeds_backleft();
	if(s1<-200||s1>200){s1=0;}
	s2 = Rte_DRead_R_4speeds_backright();
	if(s2<-200||s2>200){s2=0;}
	s3 = Rte_DRead_R_4speeds_frontleft();
	if(s3<-200||s3>200){s3=0;}
	s4 = Rte_DRead_R_4speeds_frontright();
	if(s4<-200||s4>200){s4=0;}


	//status_printf("%d, %d, %d, %d\n", s1, s2, s3, s4);
	temp=(s1+s2+s3+s4)/4;

	if((s1+20)<temp||(s1-20)>temp){//s1 filtering
	 avg_speed = (s2+s3+s4)/3;
	}
	else if((s2+20)<temp||(s2-20)>temp){//s2 filtering
		avg_speed = (s1+s3+s4)/3;
	}
	else if((s3+20)<temp||(s3-20)>temp){//s2 filtering
		   avg_speed = (s1+s2+s4)/3;
	}
	else if((s4+20)<temp||(s4-20)>temp){//s2 filtering
		   avg_speed = (s1+s3+s2)/3;
	}
	else{
	 avg_speed = temp;
	}

   Rte_Write_P_avg_speed_avg_speed_data(avg_speed);
}

