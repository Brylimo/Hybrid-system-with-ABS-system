/** @file     Rte_SEN_BATT_COMP.c
  *
  * @brief    RTE Sample SWC implementation skeleton file
  *
  * @note     AUTOMATICALLY GENERATED FILE! DO NOT EDIT!
  *
  * @note     Generated by ETAS GmbH  RTA-RTE v5.10.0  (R4.0 backend version: v7.10.4 (Build 52732))
  */

#include "Rte_SEN_BATT_COMP.h"
#include "virtualdevices.h"
/* --------------------------------------------------------------------------- */
/* RTE Event: /MotorComposition/SEN_BATT_COMP/IB_SEN_BATT_COMP/TE_300ms */

int arr[6];
int idx, isArrFull;

FUNC(void, SEN_BATT_COMP_CODE) RE_SEN_BATT_func(void)
{
	int batt_stat=0;
	Rte_Call_CS_BATT_Receive_batt_sen_op(&batt_stat);

	/* filtering */
	arr[idx] = batt_stat;

	if(!isArrFull) {
		idx++;
		if(idx == 5) {
			isArrFull = 1;
		}
	}
	else {
		for(int i=1;i<6;i++){
			arr[i-1] = arr[i];
		}

		int sum = 0;
		for(int i=0; i<5; i++) {
			if(i == 4) {
				sum += arr[i] * 1.5;
			}
			else {
				sum += arr[i];
			}
		}
		batt_stat = (int)(sum / 5.5);
	}
	//status_printf("avg batt : %d\r\n", batt_stat);
	Rte_Write_SR_BATT_Send_batt_data(batt_stat);
}

